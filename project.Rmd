---
title: "Project"
author: "Manuel Alejandro"
date: "5/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


```



## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r}
library(readr)
library(lubridate)
library(ggplot2)
library(dplyr)
library(zoo)
```


```{r}
umsatzdaten <- read.csv("umsatzdaten_gekuerzt.csv")
```
Erstellung der Variable mit Wochentag
```{r}
# Berechnung der Wochentage
umsatzdaten$wochentag <- weekdays(umsatzdaten$Datum)

# Umwandlung von 'wochentag" in eine Faktor-Variable mit einer vorgegeben Sortierung der Level (Kategorien)
umsatzdaten$wochentag <- factor(umsatzdaten$wochentag, levels=c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

```

Erstellung der Variable mit Jahreszeit
```{r}
# Berechnung der Jahresqrt
yq <- as.yearqtr(as.yearmon(umsatzdaten$Datum, "%m/%d/%Y") + 1/12)
# Berechnung der Jahreszeit
umsatzdaten$jahreszeit <- factor(format(yq, "%q"), levels = 1:4, 
      labels = c("Winter", "Frueling", "Sommer", "Herbst"))


```

Erstellung der Variable mit Feiertage 
```{r}
library(timeDate)


```

Langes Wochendende Vorher und nachher
Feiertag am Wochenende
```{r}

```

hat der Bäcker an manchen Tagen geschlossen = kein Umsatz
Vorher/nachher mehr umsatz 
```{r}

```

Schulferien
```{r}
AshWednesday() #Funktion für Ferien in Deutschland
#Ferien
```


Kieler Woche:
1. Einbinden benötigter Bibliotheken
2. Einlesen der Daten
3. Zusammenführen der Daten
```{r}
library(readr)
library(dplyr)

umsatzdaten <- read_csv("umsatzdaten_gekuerzt.csv")
kiwo <- read_csv("kiwo.csv")


daten_mit_kiwo <- left_join(umsatzdaten, kiwo)
View(daten)
```


Einbindung Wetterdaten
```{r}
library(readr)
library(dplyr)

wetter <- read_csv("wetter.csv")
View(wetter)

daten_mit_wetter<- left_join(umsatzdaten, wetter)
View(daten_mit_wetter)



```


Overfitting with linear regression
ToDo: Noch updaten!!
Importing Function Packages
```
```{r}
library(dplyr)
library(readr)
library(lubridate)
library(broom)
library(Metrics)
```

Importing Training and Test Data
ToDo: Links noch updaten!!
```{r}
baecker_umsatzdaten_train <- read_csv("https://raw.githubusercontent.com/opencampus-sh/sose20-datascience/master/house_pricing_train.csv")
baecker_umsatzdaten_test <- read_csv("https://raw.githubusercontent.com/opencampus-sh/sose20-datascience/master/house_pricing_test.csv")
```

Estimating (Training) Models
```{r}
mod1 <- lm(price ~ bathrooms, house_pricing_train)
mod2 <- lm(price ~ as.factor(bathrooms), house_pricing_train)
mod3 <- lm(price ~ as.factor(bathrooms) + as.factor(zipcode), house_pricing_train)
mod4 <- lm(price ~ as.factor(bathrooms) + as.factor(zipcode) + condition, house_pricing_train)
mod5 <- lm(price ~ as.factor(bathrooms) + as.factor(zipcode) + as.factor(condition), house_pricing_train)
mod6 <- lm(price ~ as.factor(bathrooms) + as.factor(zipcode) + as.factor(condition) + sqft_living15, house_pricing_train)
mod7 <- lm(price ~ as.factor(bathrooms) + as.factor(zipcode) + as.factor(condition) + sqft_living15 + floors + view + grade + as.factor(zipcode)*as.factor(bathrooms), house_pricing_train)
```


```{r}
summary(mod1)
```

```{r}
glance(mod1)
```

Preparation of Model Results
```{r}
rbind(glance(mod1), glance(mod2), glance(mod3), glance(mod4), glance(mod5), glance(mod6), glance(mod7))
```

Model Prediction Quality for the Training Data Using the Mean Absolute Error
```{r}
rbind(mae(house_pricing_train$price, predict(mod1)),
      mae(house_pricing_train$price, predict(mod2)),
      mae(house_pricing_train$price, predict(mod3)),
      mae(house_pricing_train$price, predict(mod4)),
      mae(house_pricing_train$price, predict(mod5)),
      mae(house_pricing_train$price, predict(mod6)),
      mae(house_pricing_train$price, predict(mod7)))
```


Model Prediction Quality for the Training Data Using the Mean Absolute Percentage Error
```{r}
rbind(mape(house_pricing_train$price, predict(mod1)),
      mape(house_pricing_train$price, predict(mod2)),
      mape(house_pricing_train$price, predict(mod3)),
      mape(house_pricing_train$price, predict(mod4)),
      mape(house_pricing_train$price, predict(mod5)),
      mape(house_pricing_train$price, predict(mod6)),
      mape(house_pricing_train$price, predict(mod7)))
```

Model Prediction Quality for the (Unknown) Test Data Using the Mean Absolute Percentage Error
```{r}
rbind(mape(house_pricing_test$price, predict(mod1, newdata=house_pricing_test)),
      mape(house_pricing_test$price, predict(mod2, newdata=house_pricing_test)),
      mape(house_pricing_test$price, predict(mod3, newdata=house_pricing_test)),
      mape(house_pricing_test$price, predict(mod4, newdata=house_pricing_test)),
      mape(house_pricing_test$price, predict(mod5, newdata=house_pricing_test)),
      mape(house_pricing_test$price, predict(mod6, newdata=house_pricing_test)),
      mape(house_pricing_test$price, predict(mod7, newdata=house_pricing_test)))


```





